---
- name: Update Weave script
  get_url:
    url: http://git.io/weave
    dest: /usr/local/bin/weave
    mode: 0755
  register: weave_updated
  register: weave_updated 
  until: weave_updated | success
  
- name: Setup Weave
  command: /usr/local/bin/weave setup
  when: weave_updated | changed
  register: weave_installed 
  until: weave_installed | success